class Animal {
  private static totalAnimals = 0;
  
  private constructor(
    public readonly species: 'dog' | 'cat',
    public readonly name: string,
    public readonly birthDate: Date
  ) {}

  static create(species: 'dog' | 'cat', name: string, birthDate: Date): Animal {
    // Валидация возраста
    const ageInYears = this.calculateAge(birthDate);
    
    if (ageInYears < 0) {
      throw new Error('Дата рождения не может быть в будущем');
    }
    
    if (ageInYears > 30) {
      throw new Error('Возраст животного не может превышать 30 лет');
    }

    // Создание животного
    const animal = new Animal(species, name, birthDate);
    
    // Увеличение счетчика только при успешном создании
    Animal.totalAnimals++;
    
    return animal;
  }

  private static calculateAge(birthDate: Date): number {
    const today = new Date();
    const birth = new Date(birthDate);
    
    // Проверка на будущую дату
    if (birth > today) {
      return -1;
    }
    
    // Расчет возраста в годах
    let age = today.getFullYear() - birth.getFullYear();
    const monthDiff = today.getMonth() - birth.getMonth();
    
    // Корректировка возраста, если день рождения еще не наступил в этом году
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
      age--;
    }
    
    return age;
  }

  static getTotalAnimals(): number {
    return Animal.totalAnimals;
  }

  getAge(): number {
    return Animal.calculateAge(this.birthDate);
  }
}

// Примеры использования
try {
  const validDog = Animal.create('dog', 'Бобик', new Date('2020-05-15'));
  console.log('Создано животное:', validDog);
  console.log('Возраст:', validDog.getAge());
  console.log('Всего животных:', Animal.getTotalAnimals());

  const validCat = Animal.create('cat', 'Мурка', new Date('2019-03-10'));
  console.log('Создано животное:', validCat);
  console.log('Всего животных:', Animal.getTotalAnimals());

  // Попытка создать животное с будущей датой
  const futureDate = new Date();
  futureDate.setFullYear(futureDate.getFullYear() + 1);
  const futureAnimal = Animal.create('dog', 'Будущий', futureDate);
} catch (error) {
  console.error('Ошибка:', error.message);
}

try {
  // Попытка создать животное старше 30 лет
  const oldDate = new Date();
  oldDate.setFullYear(oldDate.getFullYear() - 31);
  const oldAnimal = Animal.create('cat', 'Старый', oldDate);
} catch (error) {
  console.error('Ошибка:', error.message);
}

console.log('Итоговое количество животных:', Animal.getTotalAnimals());
